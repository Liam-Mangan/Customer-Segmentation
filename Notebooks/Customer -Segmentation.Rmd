---
title: "Customer-Segmentation"
author: "Liam Mangan"
date: "2025-08-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r Library}
# Load libraries
library(tidyverse)   
library(cluster)    
library(factoextra) 
library(dplyr)    
library(ggplot2)
library(GGally)
library(scales)
```


```{r Data}
# Load data (adjust path if needed)
data <- read.csv("../data/marketing_campaign.csv")
```
```{r data exploration}
summary(data)
colSums(is.na(data))
```

```{r cleaning}
# Updating categorical columns
data$Education <- as.factor(data$Education)
data$Marital_Status <- as.factor(data$Marital_Status)

# Converting birth year to age 
current_year <- as.numeric(format(Sys.Date(), "%Y"))

data <- data %>%
  mutate(Age = current_year - Year_Birth) 

# Adjusting age range
data <- data %>%
  filter(Age >= 18 & Age <= 100)

# Select features for clustering
cluster_data <- data %>%
  select(
    Age, Income, Education, Marital_Status, 
    MntWines, MntFruits, MntMeatProducts, MntFishProducts,
    MntSweetProducts, MntGoldProds, NumDealsPurchases, NumWebPurchases,
    NumCatalogPurchases, NumStorePurchases, NumWebVisitsMonth, Kidhome,
    Teenhome
  )

# Convert categorical variables to numeric
cluster_data$Education <- as.numeric(cluster_data$Education)
cluster_data$Marital_Status<- as.numeric(cluster_data$Marital_Status)
# Scale the data for clustering
cluster_data_scaled <- scale(cluster_data)

# Quick look at the cleaned, scaled data
head(cluster_data_scaled)
```
```{r Data analysis}
# Age distribution
ggplot(data, aes(x = Age)) +
  geom_histogram(fill = "steelblue", bins = 30) +
  labs(title = "Age Distribution", x = "Age", y = "Count")

# Income Distribution
removed_outliers <- data %>%
  filter(Income <= 200000)

ggplot(removed_outliers, aes(x = Income)) +
  geom_histogram(fill = "darkgreen", bins = 30, color = "white") +
  scale_x_continuous(labels = comma, limits =
  c(min(removed_outliers$Income, na.rm = TRUE), 
  max(removed_outliers$Income, na.rm =TRUE))) +
  labs(title = "Income Distribution", x = "Income", y = "Count") +
  theme_minimal()

# Income by Education 
ggplot(removed_outliers, aes(x = Education, y = Income)) +
  geom_boxplot(fill = "lightblue") +
  scale_y_continuous(labels = comma, limits =
  c(min(removed_outliers$Income, na.rm = TRUE), 
  max(removed_outliers$Income, na.rm = TRUE))) +
  labs(title = "Income by Education Level", x = "Education Level", y =
  "Income") +
  theme_minimal()

# Marital Status counts
ggplot(data, aes(x = Marital_Status)) +
  geom_bar(fill = "orange") +
  labs(title = "Marital Status Count", x = "Marital Status", y ="Count")

# Spending Behavior 
spending_vars <- c("MntWines","MntFruits","MntMeatProducts","MntFishProducts", "MntSweetProducts","MntGoldProds")

# Histograms for spending variables
data %>%
  select(all_of(spending_vars)) %>%
  gather(key = "Category", value = "Amount") %>%
  ggplot(aes(x = Amount)) +
  geom_histogram(fill = "purple", bins = 30) +
  facet_wrap(~Category, scales = "free") +
  labs(title = "Spending Distribution by Category", x = "Amount Spent", y = "Count")

# Engagement Metrics 
engagement_vars <- c("NumDealsPurchases","NumWebPurchases","NumCatalogPurchases", "NumStorePurchases","NumWebVisitsMonth")

data %>%
  select(all_of(engagement_vars)) %>%
  gather(key = "EngagementMetric", value = "Count") %>%
  ggplot(aes(x = Count)) +
  geom_histogram(fill = "darkred", bins = 30) +
  facet_wrap(~EngagementMetric, scales = "free") +
  labs(title = "Engagement Metrics Distribution", x = "Count", y = "Frequency")

#  Correlation Matrix
numeric_vars <- cluster_data_scaled  # scaled numeric variables for clustering
cor_matrix <- cor(numeric_vars)
library(corrplot)
corrplot(cor_matrix, method = "color", type = "upper", tl.cex = 0.7)

```